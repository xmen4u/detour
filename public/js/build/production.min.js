function Point(a){this.lat=0,this.lng=0,a&&"function"==typeof a.lat?(this.lat=a.lat(),this.lng=a.lng()):a&&a.hasOwnProperty("lat")&&(this.lat=a.lat,this.lng=a.lng)}function Route(){this.path=[]}function initialize(){var a,b={center:new google.maps.LatLng(37.7833,-122.4167),zoom:14,mapTypeControl:!1,panControl:!1,draggable:!1,minZoom:14};g_map=new google.maps.Map(document.getElementById("map-canvas"),b),a=google.maps.event.addListener(g_map,"click",function(a){var b,c,d=null,e=null;3>g_turn?(d=1,e=g_first_driver):g_turn>2&&5>g_turn&&(d=2,e=g_second_driver),g_turn++,d&&(c=$(".lyft > .container > span"),$("#msg-"+g_turn).removeClass("hide"),c.not("#msg-"+g_turn).addClass("hide"),b=createDriverMarker(a.latLng,d),b&&g_routes.push(b),e.pushPoint(new Point(a.latLng)),e.getLen()>1&&(b=drawRoute(e.getPath(),d),b&&g_routes.push(b))),5===g_turn&&setTimeout(function(){var a,b=calcDetour(g_first_driver,g_second_driver);a=$(".lyft > .container > span"),a.addClass("hide"),$("#msg-result").removeClass("hide").text(b.first<b.second?"1st":"2nd")},400)}),$("button.btn-lyft").click(reset)}function emptyPolylineRoutes(){var a,b=g_routes.length;for(a=0;b>a;a++)g_routes[a].setMap(null);g_routes=[]}function reset(){g_first_driver.emptyPath(),g_second_driver.emptyPath(),g_turn=1,emptyPolylineRoutes(),$('span[id*="msg-"]').not(".hide").addClass("hide"),$("#msg-1").removeClass("hide")}function calcDetour(a,b){var c=new Route,d=new Route;return c.pushPoint(a.getHead()),c.pushPoint(b.getHead()),dist_A_C=c.routeDistance(),d.pushPoint(b.getTail()),d.pushPoint(a.getTail()),dist_D_B=d.routeDistance(),{first:dist_A_C+a.routeDistance()+dist_D_B,second:dist_A_C+b.routeDistance()+dist_D_B}}function addMarker(a,b){var c,d,e,f=g_map,g={};return c=new google.maps.MarkerImage(a.src.path,a.src.size,a.src.anchor,a.src.point),e=new google.maps.MarkerImage(a.shadow.path,a.shadow.size,a.shadow.anchor,a.shadow.point),g={position:a.loc,map:f,icon:c,shadow:e,bouncy:!0,visible:!0},b&&(g.shadow=e),d=new google.maps.Marker(g),a.marker=d,d}function drawRoute(a,b){var c=a,d=new google.maps.Polyline({path:c,geodesic:!0,strokeColor:1===b?"#e062c9":"#5663dc",strokeOpacity:1,strokeWeight:2});return d.setMap(g_map),d}function createDriverMarker(a,b){var c={src:{},shadow:{},loc:a};return c.src.path=b>1?"driver2.png":"driver1.png",c.shadow.path="cyan-shadow.png",c.src.size=new google.maps.Size(256,256),c.src.anchor=new google.maps.Point(0,0),c.src.point=new google.maps.Point(128,212),c.shadow.size=new google.maps.Size(256,256),c.shadow.anchor=new google.maps.Point(0,0),c.shadow.point=new google.maps.Point(132,256),addMarker(c,!1)}Route.prototype={earthRadiusInKM:6367.5,distanceInKM:function(a,b){var c,d,e,f,g;return a&&b?(c=(a.lat-b.lat)*Math.PI/180,d=(b.lng-a.lng)*Math.PI/180,e=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2),f=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e)),g=this.earthRadiusInKM*f):0},getHead:function(){return this.path[0]},getTail:function(){return this.path[this.path.length-1]},getLen:function(){return this.path.length},routeDistance:function(){var a,b=0,c=this.path.length;for(a=0;c-1>a;a++)b+=this.distanceInKM(this.path[a],this.path[a+1]);return b},pushPoint:function(a){this.path.push(a)},getPath:function(){return this.path},emptyPath:function(){this.path=[]}},$(document).ready(function(){initialize()});var g_first_driver=new Route,g_second_driver=new Route,g_map,g_routes=[],g_turn=1;